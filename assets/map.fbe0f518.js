import{$ as r,o as t,d as p,q as _,L as c}from"./overpass.a109b6b4.js";r(document).ready(()=>{const u={};window.addEventListener("message",e=>{const n=typeof e.data=="string"?JSON.parse(e.data):{};switch(n.cmd){case"update_map":s.code.overpass=n.value[0],a.update_map();break;case"cache":s.code.overpass=n.value[0],a.getQuery(i=>{const l=a.getQueryLang();t.run_query(i,l,u,!0,void 0,a.mapcss)});break}},!1),r.fn.dialog=function(){alert(`error :( ${r(this).html()}`)},p.appname="overpass-ide-map";const s={code:{},server:p.defaultServer,tileServer:p.defaultTiles,force_simple_cors_request:!0,disable_poiomatic:!1},a={getQuery:function(e){const n=s.code.overpass,i=_();i.parse(n,{},l=>{let f="";i.hasStatement("style")&&(f=i.getStatement("style")),a.mapcss=f;let o=null;if(i.hasStatement("data")){o=i.getStatement("data"),o=o.split(",");const b=o[0].toLowerCase();o=o.slice(1);const g={};for(let d=0;d<o.length;d++){const h=o[d].split("=");g[h[0]]=h[1]}o={mode:b,options:g}}a.data_source=o,l=l.trim(),e(l)})},getQueryLang:function(){return r.trim(s.code.overpass).match(/^</)?"xml":"OverpassQL"},update_map:function(){r("#data_stats").remove(),typeof t.osmLayer<"u"&&a.map.removeLayer(t.osmLayer),a.getQuery(e=>{const n=a.getQueryLang();t.run_query(e,n,u,!1,void 0,a.mapcss)}),r("#map_blank").remove()}};t.init(),r.support.cors!=!0&&r('<div title="Your browser is not supported :("><p>The browser you are currently using, is not capable of running this Application. <small>It has to support <a href="http://en.wikipedia.org/wiki/Cross-origin_resource_sharing">cross origin resource sharing (CORS)</a>.</small></p><p>Please update to a more up-to-date version of your browser or switch to a more capable browser! Recent versions of <a href="http://www.opera.com">Opera</a>, <a href="http://www.google.com/intl/de/chrome/browser/">Chrome</a> and <a href="http://www.mozilla.org/de/firefox/">Firefox</a> have been tested to work.</p></div>').dialog({modal:!0});const m=new URLSearchParams(location.search.substring(1));s.code.overpass=m.get("Q"),s.silent=m.has("silent"),a.map=new c.Map("map");const y=s.tileServer,v=p.tileServerAttribution,w=new c.TileLayer(y,{attribution:v});a.map.setView([0,0],1).addLayer(w),new c.Control.Scale({metric:!0,imperial:!1}).addTo(a.map),r(document).on({ajaxStart:function(){r("#loading-dialog").addClass("is-active")},ajaxStop:function(){r("#loading-dialog").removeClass("is-active")}}),a.map.on("layeradd",e=>{if(e.layer instanceof c.GeoJSON){a.map.setView([0,0],18,!0);try{a.map.fitBounds(e.layer.getBounds())}catch{}}}),t.handlers.onEmptyMap=function(e){r(`<div id="map_blank" style="z-index:1; display:block; position:absolute; top:42px; width:100%; text-align:center; background-color:#eee; opacity: 0.8;">This map intentionally left blank. <small>(${e})</small></div>`).appendTo("#map")},s.silent?(t.handlers.onAjaxError=function(e){parent.postMessage(JSON.stringify({handler:"onAjaxError",msg:e}),"*")},t.handlers.onQueryError=function(e){parent.postMessage(JSON.stringify({handler:"onQueryError",msg:e}),"*")}):(t.handlers.onAjaxError=function(e){alert(`An error occured during the execution of the overpass query!
${e}`)},t.handlers.onQueryError=function(e){alert(`An error occured during the execution of the overpass query!
This is what overpass API returned:
${e}`)}),t.handlers.onGeoJsonReady=function(){a.map.addLayer(t.osmLayer)},t.handlers.onPopupReady=function(e){e.openOn(a.map)},t.handlers.onDataReceived=function(e,n,i,l){l()},t.handlers.onRawDataPresent=function(){parent.postMessage(JSON.stringify({query:s.code.overpass,resultType:t.resultType,resultText:t.resultText}),"*")},a.update_map()});
